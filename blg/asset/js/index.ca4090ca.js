(function(t){function e(e){for(var a,n,s=e[0],h=e[1],c=e[2],g=0,p=[];g<s.length;g++)n=s[g],o[n]&&p.push(o[n][0]),o[n]=0;for(a in h)Object.prototype.hasOwnProperty.call(h,a)&&(t[a]=h[a]);l&&l(e);while(p.length)p.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],a=!0,s=1;s<i.length;s++){var h=i[s];0!==o[h]&&(a=!1)}a&&(r.splice(e--,1),t=n(n.s=i[0]))}return t}var a={},o={index:0},r=[];function n(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=a,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],h=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var l=h;r.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("c31f")},"42b1":function(t,e,i){"use strict";var a=i("880c"),o=i.n(a);o.a},"880c":function(t,e,i){},c31f:function(t,e,i){"use strict";i.r(e);var a=i("2b0e"),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("p",{staticClass:"operation"},[i("button",{on:{click:t.getImageData}},[t._v("点我截图")]),i("button",{on:{click:function(e){return t.crop.changeImage()}}},[t._v("点我换图")])]),i("p",{staticClass:"watermark"},[t._v("输入水印文字：\n      "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.textWatermark,expression:"textWatermark"}],attrs:{type:"text",placeholder:"可以输入水印"},domProps:{value:t.textWatermark},on:{input:function(e){e.target.composing||(t.textWatermark=e.target.value)}}})]),i("p",{staticClass:"watermark"},[t._v("颜色\n      "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.color,expression:"color"}],attrs:{type:"text",placeholder:"16进制颜色"},domProps:{value:t.color},on:{input:function(e){e.target.composing||(t.color=e.target.value)}}})]),i("crop",{staticStyle:{width:"100%",height:"560px","background-color":"#f1f3f5"},attrs:{position:["70%","70%",3,12],textWatermark:t.textWatermark,angle:45,color:t.color},model:{value:t.crop,callback:function(e){t.crop=e},expression:"crop"}},[i("template",{slot:"placeholder"},[i("img",{staticStyle:{width:"20%"},attrs:{src:"https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1057851374,249752393&fm=26&gp=0.jpg"}})])],2),t.cropAction?i("div",{staticStyle:{"text-align":"center"}},[i("p",[t._v("长按保存图片")]),t.cropAction?i("img",{staticStyle:{width:"70%"},attrs:{src:t.imageData,alt:""}}):t._e()]):t._e()],1)},r=[],n={name:"app",data(){return{color:"#f60",textWatermark:"板蓝根出品，必属精品",crop:{},cropAction:!1,imageData:null}},methods:{uploadImg(t){this.imgwatermark=this.imgae=t.target.files[0]},changeImg(t){this.isimg=!0,this.imgwatermark=t.target.files[0]},async getImageData(){const t=await this.crop.getImage("Base64","image/png",2);this.imageData=t,this.cropAction=!0}}},s=n,h=(i("42b1"),i("2877")),c=Object(h["a"])(s,o,r,!1,null,null,null),l=c.exports,g=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"mountNode",staticClass:"mount-node",staticStyle:{overflow:"hidden"},on:{touchstart:function(e){return t.handleStart(e)},touchmove:function(e){return t.handleMove(e)}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.noImage,expression:"noImage"}],staticClass:"no-image-file",staticStyle:{height:"100%",display:"flex","justify-content":"center","align-items":"center","flex-wrap":"wrap"},on:{click:t.inputHandle,touchstart:function(t){t.stopPropagation()},touchmove:function(t){t.stopPropagation()}}},[t._t("placeholder",[i("span",[t._v("暂时没有图片,请选择图像")])]),i("div",{staticStyle:{display:"none"}},[i("input",{attrs:{type:"file",id:"file-input",accept:"image/jpeg,image/x-icon,image/png"},on:{change:t.uploadImg}}),t._t("defaultImgUrl")],2)],2)])},p=[],d={name:"crop",props:["value","position","textWatermark","imageWatermark","defaultImgUrl","color","angle"],data(){return{noImage:!0,ctx:null,options:null,pixelRatio:null,scale:1,canvas:null,image:{},points:[],lines:[],cropper:{},startPoint:{},touchBar:{},nookSide:30,rotateAngle:0}},methods:{animation(t){if(t){const e=t.width,i=t.height,{width:a,height:o}=this.options;let r=e,n=i,s=1;e>a&&(r=a,s=r/e,n=s*i),n>o&&(n=o,s=n/i,r=s*e);const h=100;e<h&&(r=h,s=r/e,n=s*i),n<h&&(n=h,s=n/i,r=s*e),this.image={element:t,width:r,height:n,x:(a-r)/2,y:(o-n)/2,clientWidth:e,clientHeight:i},this.cropper={x:(a-r/2)/2,y:(o-n/2)/2,width:r/2,height:n/2},this.touchBar={x:a-60-14,y:10,width:60,height:60},this.scale=s,this.draw()}},draw(){const{width:t,height:e}=this.options;this.ctx.clearRect(0,0,t,e),this.fillBackground(),this.fillImage(),this.averageColor||(this.averageColor=this.getImageColor(this.ctx.getImageData(this.cropper.x,this.cropper.y,50,50).data)),this.updatePoint(),this.fillCropper(),this.angle&&this.drawTouchBar()},drawTouchBar(){const t=this.ctx,e=this.touchBar,i=this.color||this.averageColor,a=e.x+.6*e.width,o=e.y+.64*e.height,r=.41*e.width,n=6,s=.1*e.width,h=.18*e.width;if(t.lineWidth=2,t.fillStyle=i,t.fillRect(a-e.width/6,o-e.height/6,.43*e.width,.43*e.height),t.strokeStyle=i,t.beginPath(),t.arc(a,o,r,Math.PI/180*180,-Math.PI/2+n,!1),t.stroke(),n<2*Math.PI){const e=a+(r-s)*Math.sin(n),i=o-(r-s)*Math.cos(n),c=a+(r+s)*Math.sin(n),l=o-(r+s)*Math.cos(n),g=(e+c)/2+h*Math.sin(n+Math.PI/2),p=(i+l)/2-h*Math.cos(n+Math.PI/2);t.beginPath(),t.moveTo(g,p),t.lineTo(e,i),t.lineTo(c,l),t.fill()}},fillImage(){const t=this.image,e=this.ctx,i=this.rotateAngle||0;this.canvasRotate("img",e,t.element,i,t.x,t.y,t.width,t.height)},updatePoint(){const t=this.cropper,e=this.nookSide,i=t.x+t.width,a=t.y+t.height,o=i-e,r=a-e;this.points=[{x:t.x,y:t.y,width:e,height:e,diffX:0,diffY:0},{x:o,y:t.y,width:e,height:e,diffX:e,diffY:0},{x:o,y:r,width:e,height:e,diffX:e,diffY:e},{x:t.x,y:r,width:e,height:e,diffX:0,diffY:e}];const n=e/.7/2,s=n/2;this.lines=[{x:t.x,y:t.y-s,width:t.width,height:n},{x:i-s,y:t.y,width:n,height:t.height},{x:t.x,y:a-s,width:t.width,height:n},{x:t.x-s,y:t.y,width:n,height:t.height}]},fillCropper(){const t=this.ctx,e=this.cropper,i=this.points,a=this.color||this.averageColor;t.strokeStyle=a,t.lineWidth=2,t.strokeRect(e.x,e.y,e.width,e.height),t.fillStyle=a;const o=this.nookSide/8;i.forEach((e,i)=>{t.save(),t.translate(e.x+e.diffX,e.y+e.diffY),t.rotate(90*i*(Math.PI/180)),t.fillRect(-o,-o,e.height,2*o),t.fillRect(-o,-o,2*o,e.width),t.restore()})},fillBackground(){const{width:t,height:e}=this.options,i=this.ctx,a=30,o=Math.ceil(t/a),r=Math.ceil(e/a);i.save(),i.fillStyle="#ccc";for(let n=0;n<r;n++)for(let t=0;t<o;t++)(t+n)%2===0&&i.fillRect(t*a,n*a,a,a);i.fillStyle="rgba(0, 0, 0, .1)",i.fillRect(0,0,t,e),i.restore()},getNewCropper(t,e,i){return{cropperWidth:i.x+i.width-t,cropperHeight:i.y+i.height-e,cropperX:t-i.x,cropperY:e-i.y}},handlePointMove({x:t,y:e}){const i=this.cropper,a={},{cropperWidth:o,cropperHeight:r,cropperX:n,cropperY:s}=this.getNewCropper(t,e,i);switch(this.index){case 0:a.width=o,a.height=r,a.x=t,a.y=e;break;case 1:a.width=n,a.height=r,a.y=e;break;case 3:a.width=o,a.height=s,a.x=t;break;case 2:a.width=n,a.height=s;break;default:break}this.renderCropper(a)},handleLineMove({x:t,y:e}){const i=this.cropper,a={},{cropperWidth:o,cropperHeight:r,cropperX:n,cropperY:s}=this.getNewCropper(t,e,i);switch(this.index){case 3:a.width=o,a.x=t;break;case 0:a.height=r,a.y=e;break;case 1:a.width=n;break;case 2:a.height=s;break;default:break}this.renderCropper(a)},renderCropper(t){t.width<=4*this.nookSide||t.height<=4*this.nookSide||(this.cropper={...this.cropper,...t},this.draw())},handleImageMove({x:t,y:e}){const i=this.startPoint;this.image.x=t-i.offsetX,this.image.y=e-i.offsetY,this.draw()},getCoordinateByEvent(t){const e=t.target.getBoundingClientRect(),i=t.touches[0],a={x:i.clientX-e.left,y:i.clientY-e.top},{width:o,height:r}=this.options;if(!(a.x<=2||a.y<=2||a.x>=o-2||a.y>=r-2))return a},handleStart(t){if(t.preventDefault(),t.touches.length>1)return this.startTouches=t.touches,void(this.startPoint.type=null);this.startPoint=this.getPointByCoordinate(this.getCoordinateByEvent(t))},handleMove(t){t.preventDefault();const e=t.touches;if(e.length>1){const t=this.image;let i,a=this.startTouches;const o=this.scale;i=this.getDistance(e[0],e[1])/this.getDistance(a[0],a[1]),i=i<1?1/(1+i/80):1+Math.abs(i)/160,i*=o,this.scale=this.limit(i,.02,4);const r=t.clientWidth*this.scale,n=t.clientHeight*this.scale;return this.image.x+=(t.width-r)/2,this.image.y+=(t.height-n)/2,this.image.width=r,this.image.height=n,void this.draw()}const i=this.startPoint.type;i&&this.getCoordinateByEvent(t)&&this[i](this.getCoordinateByEvent(t))},checkRegion(t,e,i){return t>i.x&&t<i.x+i.width&&e>i.y&&e<i.y+i.height},getPointByCoordinate({x:t,y:e}){const i=this.image,a=this.touchBar;let o={},r=0;return this.checkRegion(t,e,a)?(this.rotateAngle=(this.rotateAngle+this.angle)%360,this.draw()):this.points.some((i,a)=>{return r=a,this.checkRegion(t,e,i)})?(o.type="handlePointMove",this.index=r):this.lines.some((i,a)=>{return r=a,this.checkRegion(t,e,i)})?(o.type="handleLineMove",this.index=r):this.checkRegion(t,e,i)&&(o.offsetX=t-i.x,o.offsetY=e-i.y,o.type="handleImageMove"),o},getDistance(t,e){const i=e.pageX-t.pageX,a=e.pageY-t.pageY;return Math.sqrt(i*i+a*a)},limit(t,e,i){return t<e?e:t>i?i:t},getImage(t="Base64",e="image/jpeg",i=1){if(this.noImage)return;const a=this.image,o=this.cropper,r=this.pixelRatio,n={Base64(t,e){return new Promise(i=>{i(t.toDataURL(e))})},Blob(t,e){return new Promise(i=>{t.toBlob(t=>{i(t)},e)})}},s=o.width*i,h=o.height*i;this.canvas||(this.canvas=document.createElement("canvas"),this.cCtx=this.canvas.getContext("2d"));const c=this.cCtx;this.canvas.width=s*r,this.canvas.height=h*r,c.scale(r,r),c.clearRect(0,0,s,h);const l=this.rotateAngle||0;return this.canvasRotate("img",c,a.element,l,(a.x-o.x)*i,(a.y-o.y)*i,a.width*i,a.height*i),new Promise((a,o)=>{if(!n[t])return void o("type = Blob || Base64");const[r="50%",l="50%",g=1,p=0]=this.position;if(this.imageWatermark){let o=new Image;return o.src=this.getFileSrc(this.imageWatermark),o.crossOrigin="anonymous",void(o.onload=(()=>{const d=o.width*g*i,u=o.height*g*i,m=(s-d)*parseInt(r)/100,f=(h-u)*parseInt(l)/100;this.canvasRotate("img",c,o,p,m,f,d,u),a(n[t](this.canvas,e))}))}if(this.textWatermark){const i=this.limit(12*g,12,100);c.font=i+"px Georgia";const o=this.textWatermark,d=c.measureText(o).width,u=(s-1.031*d)*parseInt(r)/100,m=(h-2.82*i)*parseInt(l)/100;return c.fillStyle=this.color||this.averageColor,"#ffffff"===c.fillStyle&&(c.fillStyle="#000"),this.canvasRotate("text",c,o,p,u,m,d,i),void a(n[t](this.canvas,e))}a(n[t](this.canvas,e))})},canvasRotate(t,e,i,a,o,r,n,s){e.save();const h=s/2,c=n/2;e.translate(o+c,r+h),e.rotate(Math.PI/180*a),"img"===t?e.drawImage(i,-c,-h,n,s):e.fillText(i,-c,-h),e.restore()},changeImage(t){this.noImage||(this.averageColor=null,t?this.createImage(t):this.inputHandle())},getPixelRatio(t){const e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},uploadImg(t){this.createImage(t.target.files[0]),this.noImage=!1},getFileSrc(t){return"[object File]"===Object.prototype.toString.call(t)&&(t=window.URL.createObjectURL(t)),t},createImage(t){let e=new Image;e.crossOrigin="anonymous",e.src=this.getFileSrc(t),e.onload=(()=>{this.animation(e)})},inputHandle(){document.getElementById("file-input").click()},getImageColor(t){if(this.color)return this.color;let e=0,i=0,a=0;const o=50;for(var r=0;r<o;r++)for(var n=0;n<o;n++)e+=t[4*(o*r+n)],i+=t[4*(o*r+n)+1],a+=t[4*(o*r+n)+2];return e/=o*o,i/=o*o,a/=o*o,e=Math.round(e),i=Math.round(i),a=Math.round(a),`rgba(${255-e}, ${255-i}, ${255-a}, 1)`}},mounted(){const{mountNode:t}=this.$refs,{clientWidth:e,clientHeight:i}=t;this.options={width:e,height:i};let a=document.createElement("canvas");a.style.width=e+"px",a.style.height=i+"px",t.appendChild(a),this.ctx=a.getContext("2d");const o=this.pixelRatio=this.getPixelRatio(this.ctx);if(a.width=e*o,a.height=i*o,this.ctx.scale(o,o),this.defaultImgUrl||this.$slots.defaultImgUrl){const t=this.defaultImgUrl?this.defaultImgUrl:this.$slots.defaultImgUrl[0].data.attrs.src;this.createImage(t),this.noImage=!1}this.$emit("input",{getImage:this.getImage,changeImage:this.changeImage})}},u=d,m=Object(h["a"])(u,g,p,!1,null,null,null),f=m.exports;const x=function(t){x.installed||(x.installed=!0,t.component(f.name,f))};"undefined"!==typeof window&&window.Vue&&x(window.Vue);var w={install:x,crop:f};a["a"].use(w),a["a"].config.productionTip=!1,new a["a"]({render:t=>t(l)}).$mount("#app")}});
//# sourceMappingURL=index.ca4090ca.js.map