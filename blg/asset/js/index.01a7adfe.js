(function(t){function e(e){for(var a,o,h=e[0],s=e[1],c=e[2],g=0,u=[];g<h.length;g++)o=h[g],r[o]&&u.push(r[o][0]),r[o]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);l&&l(e);while(u.length)u.shift()();return n.push.apply(n,c||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],a=!0,h=1;h<i.length;h++){var s=i[h];0!==r[s]&&(a=!1)}a&&(n.splice(e--,1),t=o(o.s=i[0]))}return t}var a={},r={index:0},n=[];function o(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=a,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(i,a,function(e){return t[e]}.bind(null,a));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var h=window["webpackJsonp"]=window["webpackJsonp"]||[],s=h.push.bind(h);h.push=e,h=h.slice();for(var c=0;c<h.length;c++)e(h[c]);var l=s;n.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("c31f")},"42b1":function(t,e,i){"use strict";var a=i("880c"),r=i.n(a);r.a},"880c":function(t,e,i){},c31f:function(t,e,i){"use strict";i.r(e);i("cadf"),i("551c"),i("f751"),i("097d");var a=i("2b0e"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("p",{staticClass:"operation"},[i("button",{staticClass:"blue",on:{click:t.getImageData}},[t._v("点我截图")]),i("button",{staticClass:"blue",on:{click:function(e){return t.crop.changeImage()}}},[t._v("点我换图")])]),i("p",{staticClass:"watermark"},[t._v("输入水印文字：\n      "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.textWatermark,expression:"textWatermark"}],attrs:{type:"text",placeholder:"可以输入水印"},domProps:{value:t.textWatermark},on:{input:function(e){e.target.composing||(t.textWatermark=e.target.value)}}})]),i("p",{staticClass:"watermark"},[t._v("输入水印颜色：\n      "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.color,expression:"color"}],attrs:{type:"text",placeholder:"可以输入水印"},domProps:{value:t.color},on:{input:function(e){e.target.composing||(t.color=e.target.value)}}})]),i("p",{staticClass:"operation"},[i("button",{class:{blue:"rect"==t.shape},on:{click:function(e){t.shape="rect"}}},[t._v("矩形截图")]),i("button",{class:{blue:"arc"==t.shape},on:{click:function(e){t.shape="arc"}}},[t._v("圆形换图")])]),i("crop",{staticStyle:{width:"100%",height:"560px","background-color":"#f1f3f5"},attrs:{position:t.option,textWatermark:t.textWatermark,imageWatermark:t.imgWatermark,angle:15,color:t.color,shape:t.shape},model:{value:t.crop,callback:function(e){t.crop=e},expression:"crop"}},[i("template",{slot:"placeholder"},[i("img",{staticStyle:{width:"20%"},attrs:{src:"https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1057851374,249752393&fm=26&gp=0.jpg"}})])],2),t.cropAction?i("div",{staticStyle:{"text-align":"center"}},[i("p",[t._v("长按保存图片")]),t.cropAction?i("img",{staticStyle:{width:"70%"},attrs:{src:t.imageData,alt:""}}):t._e()]):t._e()],1)},n=[],o=(i("96cf"),i("3b8d")),h={name:"app",data:function(){return{option:["70%","70%",.2,12],color:"#f60",imgWatermark:"",textWatermark:"板蓝根出品，必属精品",crop:{},cropAction:!1,imageData:null,shape:"arc"}},methods:{uploadImg:function(t){this.imgWatermark=t.target.files[0]},getImageData:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.crop.getImage("Base64","image/png",2);case 2:e=t.sent,this.imageData=e,this.cropAction=!0;case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()}},s=h,c=(i("42b1"),i("2877")),l=Object(c["a"])(s,r,n,!1,null,null,null),g=l.exports,u=(i("7f7f"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"mountNode",staticClass:"mount-node",staticStyle:{overflow:"hidden"},on:{touchstart:function(e){return t.handleStart(e)},touchmove:function(e){return t.handleMove(e)}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.noImage,expression:"noImage"}],staticClass:"no-image-file",staticStyle:{height:"100%",display:"flex","justify-content":"center","align-items":"center","flex-wrap":"wrap"},on:{click:t.inputHandle,touchstart:function(t){t.stopPropagation()},touchmove:function(t){t.stopPropagation()}}},[t._t("placeholder",[i("span",[t._v("暂时没有图片,请选择图像")])]),i("div",{staticStyle:{display:"none"}},[i("input",{attrs:{type:"file",id:"file-input",accept:"image/jpeg,image/x-icon,image/png"},on:{change:t.uploadImg}}),t._t("defaultImgUrl")],2)],2)])}),p=[],d=(i("6b54"),i("e814")),f=i.n(d),m=i("768b"),v=i("795b"),x=i.n(v),y=i("cebc"),w=(i("ac6a"),i("6c7b"),{name:"crop",props:["value","position","textWatermark","imageWatermark","defaultImgUrl","color","angle","shape"],data:function(){return{noImage:!0,ctx:null,options:null,pixelRatio:null,scale:1,canvas:null,image:{},points:[],lines:[],cropper:{},corePoint:{},startPoint:{},touchBar:{},nookSide:30,rotateAngle:0}},watch:{shape:function(){this.noImage||this.draw()}},methods:{animation:function(t){var e=t.width,i=t.height,a=this.options,r=a.width,n=a.height,o=e,h=i,s=1;e>r&&(o=r,s=o/e,h=s*i),h>n&&(h=n,s=h/i,o=s*e);var c=100;e<c&&(o=c,s=o/e,h=s*i),h<c&&(h=c,s=h/i,o=s*e),this.image={element:t,width:o,height:h,x:(r-o)/2,y:(n-h)/2,clientWidth:e,clientHeight:i};var l=this.corePoint={x:r/2,y:n/2};this.maxRadius=Math.min(r,n)/2,this.arc={x:l.x,y:l.y,r:this.maxRadius/2},this.cropper={x:(r-o/2)/2,y:(n-h/2)/2,width:o/2,height:h/2},this.touchBar={x:r-60-14,y:10,width:60,height:60},this.draw()},draw:function(){var t=this.options,e=t.width,i=t.height;this.ctx.clearRect(0,0,e,i),this.fillBackground(),this.fillImage(),this.averageColor||(this.averageColor=this.getImageColor(this.ctx.getImageData(this.corePoint.x-25,this.corePoint.y-25,50,50).data)),"arc"===this.shape?this.fillArcCropper():(this.updatePoint(),this.fillRectCropper()),this.angle&&this.drawTouchBar()},drawTouchBar:function(){var t=this.ctx,e=this.touchBar,i=this.color||this.averageColor,a=e.x+.6*e.width,r=e.y+.64*e.height,n=.41*e.width,o=6,h=.1*e.width,s=.18*e.width;if(t.lineWidth=2,t.fillStyle=i,t.fillRect(a-e.width/6,r-e.height/6,.43*e.width,.43*e.height),t.strokeStyle=i,t.beginPath(),t.arc(a,r,n,Math.PI/180*180,-Math.PI/2+o,!1),t.stroke(),o<2*Math.PI){var c=a+(n-h)*Math.sin(o),l=r-(n-h)*Math.cos(o),g=a+(n+h)*Math.sin(o),u=r-(n+h)*Math.cos(o),p=(c+g)/2+s*Math.sin(o+Math.PI/2),d=(l+u)/2-s*Math.cos(o+Math.PI/2);t.beginPath(),t.moveTo(p,d),t.lineTo(c,l),t.lineTo(g,u),t.fill()}},fillImage:function(){var t=this.image,e=this.ctx,i=this.rotateAngle;this.canvasRotate("img",e,t.element,i,t.x,t.y,t.width,t.height)},updatePoint:function(){var t=this.cropper,e=this.nookSide,i=t.x+t.width,a=t.y+t.height,r=i-e,n=a-e;this.points=[{x:t.x,y:t.y,width:e,height:e,diffX:0,diffY:0},{x:r,y:t.y,width:e,height:e,diffX:e,diffY:0},{x:r,y:n,width:e,height:e,diffX:e,diffY:e},{x:t.x,y:n,width:e,height:e,diffX:0,diffY:e}];var o=e/.7,h=o/2;this.lines=[{x:t.x,y:t.y-h,width:t.width,height:o},{x:i-h,y:t.y,width:o,height:t.height},{x:t.x,y:a-h,width:t.width,height:o},{x:t.x-h,y:t.y,width:o,height:t.height}]},fillRectCropper:function(){var t=this.ctx,e=this.cropper,i=this.points,a=this.color||this.averageColor;t.strokeStyle=a,t.lineWidth=2,t.strokeRect(e.x,e.y,e.width,e.height),t.fillStyle=a;var r=this.nookSide/8;i.forEach(function(e,i){t.save(),t.translate(e.x+e.diffX,e.y+e.diffY),t.rotate(90*i*(Math.PI/180)),t.fillRect(-r,-r,e.height,2*r),t.fillRect(-r,-r,2*r,e.width),t.restore()})},fillArcCropper:function(){var t=this.ctx;t.beginPath(),t.strokeStyle=this.color||this.averageColor,t.lineWidth=2,t.arc(this.arc.x,this.arc.y,this.arc.r,0,2*Math.PI),t.stroke()},handleArcMove:function(t){var e=t.x,i=t.y;this.arc.r=this.limit(this.getDistance({pageX:e,pageY:i},{pageX:this.arc.x,pageY:this.arc.y}),2*this.nookSide,this.maxRadius),this.draw()},fillBackground:function(){var t=this.options,e=t.width,i=t.height,a=this.ctx,r=30,n=Math.ceil(e/r),o=Math.ceil(i/r);a.save(),a.fillStyle="#ccc";for(var h=0;h<o;h++)for(var s=0;s<n;s++)(s+h)%2===0&&a.fillRect(s*r,h*r,r,r);a.fillStyle="rgba(0, 0, 0, .1)",a.fillRect(0,0,e,i),a.restore()},getNewCropper:function(t,e,i){return{cropperWidth:i.x+i.width-t,cropperHeight:i.y+i.height-e,cropperX:t-i.x,cropperY:e-i.y}},handlePointMove:function(t){var e=t.x,i=t.y,a=this.cropper,r={},n=this.getNewCropper(e,i,a),o=n.cropperWidth,h=n.cropperHeight,s=n.cropperX,c=n.cropperY;switch(this.index){case 0:r.width=o,r.height=h,r.x=e,r.y=i;break;case 1:r.width=s,r.height=h,r.y=i;break;case 3:r.width=o,r.height=c,r.x=e;break;case 2:r.width=s,r.height=c;break;default:break}this.renderCropper(r)},handleLineMove:function(t){var e=t.x,i=t.y,a=this.cropper,r={},n=this.getNewCropper(e,i,a),o=n.cropperWidth,h=n.cropperHeight,s=n.cropperX,c=n.cropperY;switch(this.index){case 3:r.width=o,r.x=e;break;case 0:r.height=h,r.y=i;break;case 1:r.width=s;break;case 2:r.height=c;break;default:break}this.renderCropper(r)},renderCropper:function(t){t.width<=4*this.nookSide||t.height<=4*this.nookSide||(this.cropper=Object(y["a"])({},this.cropper,t),this.draw())},handleImageMove:function(t){var e=t.x,i=t.y,a=this.startPoint;this.image.x=e-a.offsetX,this.image.y=i-a.offsetY,this.draw()},getCoordinateByEvent:function(t){var e=t.target.getBoundingClientRect(),i=t.touches[0],a={x:i.clientX-e.left,y:i.clientY-e.top},r=this.options,n=r.width,o=r.height;if(!(a.x<=2||a.y<=2||a.x>=n-2||a.y>=o-2))return a},handleStart:function(t){if(t.preventDefault(),t.touches.length>1)return this.startTouches=t.touches,void(this.startPoint.type=null);this.startPoint=this.getPointByCoordinate(this.getCoordinateByEvent(t))},handleMove:function(t){t.preventDefault();var e=t.touches;if(e.length>1){var i,a=this.image,r=this.startTouches,n=this.scale;i=this.getDistance(e[0],e[1])/this.getDistance(r[0],r[1]),i=i<1?1/(1+i/80):1+Math.abs(i)/160,i*=n,this.scale=this.limit(i,.02,4);var o=a.clientWidth*this.scale,h=a.clientHeight*this.scale;return this.image.x+=(a.width-o)/2,this.image.y+=(a.height-h)/2,this.image.width=o,this.image.height=h,void this.draw()}var s=this.startPoint.type;s&&this.getCoordinateByEvent(t)&&this[s](this.getCoordinateByEvent(t))},checkRegion:function(t,e,i){return t>i.x&&t<i.x+i.width&&e>i.y&&e<i.y+i.height},checkArc:function(t,e){var i=this.ctx;return i.beginPath(),i.lineWidth=this.nookSide/.7,i.arc(this.arc.x,this.arc.y,this.arc.r+i.lineWidth,0,2*Math.PI),i.isPointInPath(t*this.pixelRatio,e*this.pixelRatio)&&this.getDistance({pageX:t,pageY:e},{pageX:this.arc.x,pageY:this.arc.y})>this.arc.r-i.lineWidth/2},getPointByCoordinate:function(t){var e=this,i=t.x,a=t.y,r=this.image,n=this.touchBar,o={},h=0;return this.checkRegion(i,a,n)?(this.rotateAngle=(this.rotateAngle+this.angle)%360,void this.draw()):("arc"===this.shape&&this.checkArc(i,a)?o.type="handleArcMove":"arc"!==this.shape&&this.points.some(function(t,r){return h=r,e.checkRegion(i,a,t)})?(o.type="handlePointMove",this.index=h):"arc"!==this.shape&&this.lines.some(function(t,r){return h=r,e.checkRegion(i,a,t)})?(o.type="handleLineMove",this.index=h):this.checkRegion(i,a,r)&&(o.offsetX=i-r.x,o.offsetY=a-r.y,o.type="handleImageMove"),o)},getDistance:function(t,e){var i=e.pageX-t.pageX,a=e.pageY-t.pageY;return Math.sqrt(i*i+a*a)},limit:function(t,e,i){return t<e?e:t>i?i:t},getImage:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Base64",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!this.noImage){var r=this.image,n="arc"===this.shape?{x:this.arc.x-this.arc.r,y:this.arc.y-this.arc.r,width:2*this.arc.r,height:2*this.arc.r}:this.cropper,o=this.pixelRatio,h={Base64:function(t,e){return new x.a(function(i){i(t.toDataURL(e))})},Blob:function(t,e){return new x.a(function(i){t.toBlob(function(t){i(t)},e)})}},s=n.width*a,c=n.height*a;this.canvas||(this.canvas=document.createElement("canvas"),this.cCtx=this.canvas.getContext("2d"));var l=this.cCtx;this.canvas.width=s*o,this.canvas.height=c*o,l.scale(o,o),l.clearRect(0,0,s,c);var g=this.rotateAngle;if("arc"===this.shape){var u=n.width;l.beginPath(),l.lineWidth=10,l.arc(u,u,u,0,2*Math.PI,!1),l.clip()}return this.canvasRotate("img",l,r.element,g,(r.x-n.x)*a,(r.y-n.y)*a,r.width*a,r.height*a),new x.a(function(r,n){if(h[e]){var o=Object(m["a"])(t.position,4),g=o[0],u=void 0===g?"50%":g,p=o[1],d=void 0===p?"50%":p,v=o[2],x=void 0===v?1:v,y=o[3],w=void 0===y?0:y;if(t.imageWatermark){var k=new Image;return k.src=t.getFileSrc(t.imageWatermark),k.crossOrigin="anonymous",void(k.onload=function(){var n=k.width*x*a,o=k.height*x*a,g=(s-n)*f()(u)/100,p=(c-o)*f()(d)/100;t.canvasRotate("img",l,k,w,g,p,n,o),r(h[e](t.canvas,i))})}if(t.textWatermark){var b=t.limit(12*x,12,100);l.font=b+"px Georgia";var I=t.textWatermark,P=l.measureText(I).width,R=(s-1.031*P)*f()(u)/100,S=(c-2.82*b)*f()(d)/100;return l.fillStyle=t.color||t.averageColor,"#ffffff"===l.fillStyle&&(l.fillStyle="#000"),t.canvasRotate("text",l,I,w,R,S,P,b),void r(h[e](t.canvas,i))}r(h[e](t.canvas,i))}else n("type = Blob || Base64")})}},canvasRotate:function(t,e,i,a,r,n,o,h){e.save();var s=h/2,c=o/2;e.translate(r+c,n+s),e.rotate(Math.PI/180*a),"img"===t?e.drawImage(i,-c,-s,o,h):e.fillText(i,-c,-s),e.restore()},changeImage:function(t){this.noImage||(this.averageColor=null,t?this.createImage(t):this.inputHandle())},getPixelRatio:function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},uploadImg:function(t){this.createImage(t.target.files[0]),this.noImage=!1},getFileSrc:function(t){return"[object File]"===Object.prototype.toString.call(t)&&(t=window.URL.createObjectURL(t)),t},createImage:function(t){var e=this,i=new Image;i.crossOrigin="anonymous",i.src=this.getFileSrc(t),i.onload=function(){e.animation(i)}},inputHandle:function(){document.getElementById("file-input").click()},getImageColor:function(t){for(var e=0,i=0,a=0,r=50,n=0;n<r;n++)for(var o=0;o<r;o++)e+=t[4*(r*n+o)],i+=t[4*(r*n+o)+1],a+=t[4*(r*n+o)+2];return e/=r*r,i/=r*r,a/=r*r,e=Math.round(e),i=Math.round(i),a=Math.round(a),"rgba(".concat(255-e,", ").concat(255-i,", ").concat(255-a,", 1)")}},mounted:function(){var t=this.$refs.mountNode,e=t.clientWidth,i=t.clientHeight;this.options={width:e,height:i};var a=document.createElement("canvas");a.style.width=e+"px",a.style.height=i+"px",t.appendChild(a),this.ctx=a.getContext("2d");var r=this.pixelRatio=this.getPixelRatio(this.ctx);if(a.width=e*r,a.height=i*r,this.ctx.scale(r,r),this.defaultImgUrl||this.$slots.defaultImgUrl){var n=this.defaultImgUrl?this.defaultImgUrl:this.$slots.defaultImgUrl[0].data.attrs.src;this.createImage(n),this.noImage=!1}this.$emit("input",{getImage:this.getImage,changeImage:this.changeImage})}}),k=w,b=Object(c["a"])(k,u,p,!1,null,null,null),I=b.exports,P=function t(e){t.installed||(t.installed=!0,e.component(I.name,I))};"undefined"!==typeof window&&window.Vue&&P(window.Vue);var R={install:P,crop:I};a["a"].use(R),a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(g)}}).$mount("#app")}});
//# sourceMappingURL=index.01a7adfe.js.map